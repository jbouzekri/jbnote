<div class="page-header">
  <h1>Installation</h1>
</div>


<mat-sidenav-container>
  <mat-sidenav #sidenav mode="over" position="end">
    <mat-vertical-stepper>
      <mat-step label="Go to the Firebase console" completed="false">
        <p>Go to <a href="https://console.firebase.google.com" target="_blank">https://console.firebase.google.com</a> and click on <strong>Add project</strong></p>
        <img src="../../assets/install/step1-go-to-console.png" class="responsive-img" />
      </mat-step>
      <mat-step label="Create a Firebase project" completed="false">
        <p>Give a <strong>name</strong> to your project and select a <strong>country/region</strong> then click on the <strong>create project</strong> button</p>
        <img src="../../assets/install/step2-add-project.png" class="responsive-img" />
        <small>Note that the project in these screenshots has been deleted since then so all keys and credentials don't exist anymore.</small>
      </mat-step>
      <mat-step label="Initialize the database" completed="false">
        <p>Click on the <strong>Database</strong> entry in the left menu to initialize the default realtime database.</p>
        <img src="../../assets/install/step3-init-db.png" class="responsive-img" />
        <p>Then go back to <strong>Overview</strong> and click on <strong>Add Firebase to your web app</strong>.</p>
      </mat-step>
      <mat-step label="Configure the web app" completed="false">
        <p>Configure the <em>jbnote app</em> with the different items in the popup : <strong>apiKey</strong>, <strong>authDomain</strong>, <strong>databaseURL</strong>, <strong>projectId</strong> and <strong>storageBucket</strong></p>
        <img src="../../assets/install/step4-configure-webapp.png" class="responsive-img" />
      </mat-step>
      <mat-step label="Disable auth" completed="false" optional="true">
        <p>
          Click on the <strong>Database</strong> entry in the left menu then click on the <strong>Rules</strong> tab.
          Here you can configure the security rules for your Firebase database. If you want to allow anonymous access, replace the default rules by :
        </p>
        <markdown-to-html>
          ```json
          {{ '{' }}
              "rules": {{ '{' }}
                  ".read": true,
                  ".write": true
              {{ '}' }}
          {{ '}' }}
          ```
        </markdown-to-html>
        <p>
          Then click on <strong>Publish</strong>.
          If you chose this solution, uncheck <strong>Enable Firebase user auth</strong> in the <em>jbnote app</em> config form and <strong>save</strong> your configuration.
          You are finished and you will be redirected to the note app. If you want to enable auth, continue this help to the next step.
        </p>
      </mat-step>
      <mat-step label="Enable Email/Password sign-in" completed="false" optional="true">
        <p>
          Click on the <strong>Authentication</strong> entry in the left menu then click on the <strong>Set up sign-in method</strong> button.
          In the list of all available sign-in providers, click on the <strong>Email/Password</strong> line then enable this provider and click on <strong>Save</strong>
        </p>
        <img src="../../assets/install/step6-enable-signin.png" class="responsive-img" />
        <small>Note that you can enable additional authorised domain on this page. Be sure to enable the <em>jbnote app</em> domain too</small>
      </mat-step>
      <mat-step label="Create an Email/Password user" completed="false" optional="true">
        <p>
          Go back to the <strong>Authentication</strong> page and click on the <strong>Add user</strong> button.
          Set an <strong>Email</strong> and a <strong>Password</strong> for your user and create on <strong>Add user</strong>.
        </p>
        <img src="../../assets/install/step7-create-user.png" class="responsive-img" />
        <p>
          In the <em>jbnote app</em>, check the <strong>Enable Firebase user auth</strong> option and fill the <strong>Username</strong> and <strong>Password</strong> fields
          that appear with the credentials you have just created the <strong>Save</strong> the form.
        </p>
      </mat-step>
      <mat-step label="End" completed="false">
        <p>
          When you save the configuration form, you are redirected to the part of the app that manage the note. You can come back to this install section anytime you want
          by clicking on the sync icon on the top right corner of the app.
        </p>
      </mat-step>
    </mat-vertical-stepper>
  </mat-sidenav>

  <!-- stepper -->
  <mat-horizontal-stepper linear="true" #stepper>
    <!-- activate step -->
    <mat-step #stepEnableSync label="Activate" [stepControl]="enableSyncFormControl">
      <mat-card>
        <p class="text-row">
          Do you want to enable sync between devices ?<br />
          <br />
          You will need a Google account with the Firebase service enabled (the free plan is good enough for this app).<br />
          <br />
          <small>(You can enable synchronization later)</small>
        </p>

        <div class="button-row">
          <button type="button" mat-raised-button color="primary" (click)="enableSync()">Yes I want to !</button>
          <button type="button" mat-raised-button color="warn" (click)="disableSync()">No I don't want to !</button>
        </div>
      </mat-card>
    </mat-step>
    <!-- /activate step -->

    <!-- configure step -->
    <mat-step #stepConfigSync label="Configure" [stepControl]="configForm">
      <mat-card>
        <form [formGroup]="configForm" (ngSubmit)="onSubmit()" novalidate class="app-form app-form--install">
          <!-- apikey field -->
          <mat-form-field>
            <input matInput placeholder="apiKey" [formControl]="apiKey">
            <mat-hint align="start">apiKey is an alphanumerical string with dashes or underscores</mat-hint>
            <mat-error *ngIf="apiKey.hasError('pattern')">
              Please enter a valid apiKey
            </mat-error>
            <mat-error *ngIf="apiKey.hasError('required')">
              apiKey is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /apikey field -->

          <!-- authDomain field -->
          <mat-form-field>
            <input matInput placeholder="authDomain" [formControl]="authDomain">
            <mat-hint align="start">authDomain follows this format : <strong>somekey-98712.firebaseapp.com</strong></mat-hint>
            <mat-error *ngIf="authDomain.hasError('pattern')">
              Please enter a valid authDomain
            </mat-error>
            <mat-error *ngIf="authDomain.hasError('required')">
              authDomain is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /authDomain field -->

          <!-- databaseURL field -->
          <mat-form-field>
            <input matInput placeholder="databaseURL" [formControl]="databaseURL">
            <mat-hint align="start">databaseURL follows this format : <strong>https://somekey-87641.firebaseio.com</strong></mat-hint>
            <mat-error *ngIf="databaseURL.hasError('pattern')">
              Please enter a valid databaseURL
            </mat-error>
            <mat-error *ngIf="databaseURL.hasError('required')">
              databaseURL is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /databaseURL field -->

          <!-- storageBucket field -->
          <mat-form-field style="margin-bottom: 1em;">
            <input matInput placeholder="storageBucket" [formControl]="storageBucket">
            <mat-hint align="start">storageBucket follows this format : <strong>somekey-03257.appspot.com</strong></mat-hint>
            <mat-error *ngIf="storageBucket.hasError('pattern')">
              Please enter a valid storageBucket
            </mat-error>
            <mat-error *ngIf="storageBucket.hasError('required')">
              storageBucket is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /storageBucket field -->

          <!-- enableAuth field -->
          <mat-slide-toggle [formControl]="enableAuth" color="primary">
            Enable Firebase user auth
          </mat-slide-toggle>
          <!-- /enableAuth field -->

          <!-- username field -->
          <mat-form-field *ngIf="enableAuth.value">
            <input matInput placeholder="Username" [formControl]="username">
            <mat-hint align="start">A username for the Email/Password provider with read/write access</mat-hint>
            <mat-error *ngIf="username.hasError('required')">
              username is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /username field -->

          <!-- password field -->
          <mat-form-field *ngIf="enableAuth.value">
            <input matInput placeholder="Password" [formControl]="password">
            <mat-hint align="start">The password of the user</mat-hint>
            <mat-error *ngIf="password.hasError('required')">
              password is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <!-- /password field -->

          <div class="app-form-buttons">
            <button mat-raised-button color="primary" type="submit" [disabled]="!configForm.valid">Save</button>
            <button mat-raised-button color="accent" type="reset" (click)="configForm.reset()">Reset</button>
            <button mat-raised-button type="button" (click)="stepper.previous()" class="app-form-buttons--right">Back</button>
          </div>
        </form>
      </mat-card>
    </mat-step>
    <!-- /configure step -->

    <!-- done step -->
    <mat-step label="Done">
      Synchronization configuration is finished. You are going to be redirected to the note app shortly ...
    </mat-step>
    <!-- /done step -->
  </mat-horizontal-stepper>
  <!-- /stepper -->
</mat-sidenav-container>

<button id="open-help" type="button" mat-fab color="warn" (click)="sidenav.toggle()" title="Open sidebar help window describing how to get firebase settings" *ngIf="stepper.selectedIndex === 1">
  <mat-icon class="md-24" aria-label="Help icon">help</mat-icon>
</button>
